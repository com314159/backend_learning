Linux 主机安全是一个系统性的工程，涵盖了从基础配置到高级防御的多个层面。以下是你可以系统学习和实践的关键点，我将它们分为不同层级和类别，方便你循序渐进地掌握。

### 一、基础安全加固（人人都应掌握）

这是保障 Linux 主机安全的第一道防线，也是最基本、最有效的措施。

1.  **账户与认证安全**
    *   **最小权限原则**：禁止 root 远程登录 (`PermitRootLogin no`)，使用普通用户登录后通过 `sudo` 提权。
    *   **强密码策略**：使用复杂密码，并通过 `/etc/login.defs` 和 `chage` 命令设置密码过期时间。
    *   **禁用无用账户**：检查 `/etc/passwd`，禁用或删除无需登录的系统账户（如 `bin`, `daemon` 等）。
    *   **使用 SSH 密钥认证**：完全禁用密码登录，仅使用更安全的密钥对认证 (`PasswordAuthentication no`)。
    *   **限制 su/sudo 权限**：通过 `/etc/sudoers` 精细控制哪些用户能以何种权限执行哪些命令。

2.  **网络安全**
    *   **防火墙 (iptables/nftables/firewalld)**：必须掌握！只开放必要的端口（如 SSH 的 22，Web 的 80/443），拒绝所有其他端口的入站连接。
    *   **SSH 安全加固**：
        *   修改默认端口（如 `Port 2222`）。
        *   使用 `AllowUsers` 或 `DenyUsers` 限制可登录的用户。
        *   使用 `Fail2ban` 或 `denyhosts` 工具自动屏蔽多次尝试失败的 IP 地址。
    *   **关闭不必要的网络服务**：使用 `netstat -tulpn` 或 `ss -tulpn` 查看监听端口，停止并禁用任何非必需的服务（如 `telnet`, `rpcbind`）。

3.  **系统配置与软件安全**
    *   **定期更新系统**：建立流程，定期使用 `yum update` / `apt update && apt upgrade` 安装安全补丁。
    *   **最小化安装**：安装系统时，只选择必要的软件包，减少攻击面。
    *   **卸载无用软件**：移除不需要的软件包（如 `telnet`, `ftp` 等旧工具）。

### 二、中级安全防护（提升防御深度）

在基础加固之上，建立更主动的防御和监控能力。

1.  **权限控制**
    *   **文件与目录权限**：理解并正确设置 `chmod`（用户/组/其他）和 `chown`，遵循最小权限原则。特别关注 SUID/SGID 文件（`find / -perm /6000`），确认其合法性。
    *   **使用访问控制列表 (ACL)**：对于复杂的权限需求，使用 `setfacl` 进行更精细的控制。

2.  **日志与审计**
    *   **集中日志分析**：配置 `rsyslog` 或 `syslog-ng` 将日志发送到中央日志服务器，避免本地日志被攻击者篡改或删除。
    *   **使用审计系统 (auditd)**：用于记录高级别的安全事件，如：
        *   用户认证（成功/失败的登录）。
        *   文件改动（监控重要配置文件，如 `/etc/passwd`, `/etc/shadow`）。
        *   系统调用监控。
    *   **日志监控工具**：学习使用 `logwatch` 或更专业的 SIEM（安全信息和事件管理）系统进行日志分析和告警。

3.  **入侵检测**
    *   **文件完整性检查 (FIM)**：使用 `AIDE` 或 `Tripwire` 建立系统文件的“指纹”数据库，定期扫描对比，如有被篡改则告警。
    *   ** rootkit 检测**：定期使用 `rkhunter` 或 `chkrootkit` 扫描系统。

### 三、高级安全实践（构建纵深防御体系）

1.  **安全内核与模块**
    *   **SELinux/AppArmor**：**强烈建议学习！** 这是最重要的强制访问控制（MAC）系统。它能为每个进程和文件定义严格的权限策略，即使攻击者获得了某个服务的权限，也无法突破 SELinux/AppArmor 的约束去做其他事情。从 `Enforcing` 模式开始学习。

2.  **容器与虚拟化安全**
    *   **Docker 安全**：学习非 root 用户运行容器、使用安全镜像、限制容器能力（`--cap-drop`）、设置容器资源限制等。
    *   **容器安全扫描**：使用 `Trivy`, `Grype` 等工具扫描镜像漏洞。

3.  **漏洞管理**
    *   定期使用 `lynis` 进行系统安全审计，它会给出详细的加固建议。
    *   使用 `OpenVAS`, `Trivy` 等漏洞扫描器对主机进行扫描。

4.  **备份与恢复**
    *   制定并测试可靠的备份策略（异地、离线备份）。这是安全防护的最后一道防线，用于在被入侵后快速恢复业务。

### 四、安全工具与资源

| 工具名称 | 类别 | 用途 |
| :--- | :--- | :--- |
| **fail2ban** | 入侵防御 | 动态屏蔽暴力破解IP |
| **AIDE** / **Tripwire** | 入侵检测 | 文件完整性检查 |
| **lynis** | 安全审计 | 系统漏洞扫描与加固建议 |
| **rkhunter** / **chkrootkit** | 入侵检测 |  rootkit 检测 |
| **ClamAV** | 恶意软件扫描 | 病毒/恶意软件扫描 |
| **auditd** | 审计 | 系统调用和安全事件审计 |
| **SELinux** / **AppArmor** | 访问控制 | 强制访问控制系统 |

### 学习路径建议

1.  **第一步**：彻底掌握 **“基础安全加固”** 部分的所有内容。这是根本，能抵御大部分自动化脚本的攻击。
2.  **第二步**：学习配置和查看**日志**，并部署 `fail2ban`。然后开始学习 **SELinux/AppArmor** 的基本概念和操作（如何查看日志、修改布尔值、让服务在强制模式下正常工作）。
3.  **第三步**：实践 **入侵检测**，部署 `AIDE` 并建立基线，定期扫描。
4.  **第四步**：使用 `lynis` 等工具进行全盘扫描，根据其输出报告查漏补缺，深入学习其他高级主题。

**核心安全原则始终是：**
*   **最小权限原则**：只授予必要的权限。
*   **纵深防御**：不依赖单一安全措施，构建多层防护。
*   **永不信任，持续验证**：假设网络和系统都不可信，通过监控和审计来验证其安全性。

Linux 安全是一个需要持续学习和实践的领域，从这些点开始，你的主机安全性将得到极大提升。
